{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "logAnalyticsWorkspaceName": {
            "type": "string",
            "metadata": {
                "description": "Create new or use an existing Log Analytic Workspace"
            }
        },
        "logAnalyticsRegion": {
            "type": "string",
            "allowedValues": [
               "East US",
                "West Europe",
                "Southeast Asia",
                "Australia Southeast",
                "West Central US",
                "Japan East",
                "UK South",
                "Central India",
                "Canada Central",
                "East US 2 EUAP",
                "West US 2",
                "Australia Central",
                "Australia East",
                "France Central",
                "Korea Central",
                "North Europe",
                "Central US",
                "East Asia",
                "East US 2",
                "South Central US",
                "North Central US",
                "West US",
                "UK West",
                "South Africa North",
                "Brazil South",
                "Switzerland North",
                "Switzerland West"
            ],
            "metadata": {
                "description": "Specify the Azure Region for your new or existing OMS workspace"
            }
        },
         "automationAccountName": {
            "type": "string",
            "metadata": {
                "description": "Use an existing Automation account or create a new"
            }
        },
        "automationRegion": {
            "type": "string",
            "allowedValues": [
                "Japan East",
                "East US 2",
                "West Europe",
                "South Africa North",
                "UK West",
                "Switzerland North",
                "Southeast Asia",
                "South Central US",
                "North Central US",
                "East Asia",
                "Central US",
                "West US",
                "Australia Central",
                "Australia East",
                "Korea Central",
                "East US",
                "West US 2",
                "Brazil South",
                "Central US EUAP",
                "UK South",
                "West Central US",
                "North Europe",
                "Canada Central",
                "Australia Southeast",
                "Central India",
                "France Central"
            ],
            "metadata": {
                "description": "Specify the Azure Region for your OMS Automation Account"
            }
        },
        "_artifactsLocation": {
            "type": "string",
            "defaultValue": "https://armstore2019.blob.core.windows.net/rbacmonitor",
            "metadata": {
                "description": "The base URI where artifacts required by this template are located"
            }
        },
        "_artifactsLocationSasToken": {
            "type": "securestring",
            "defaultValue": "",
            "metadata": {
                "description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."
            }
        }
    },
    "variables": {
        "runbooks": {
            "ingestParentRunbook": {
                "name": "AzureRBACCollector",
                "version": "1.0.0.2",
                "description": "Runbook to collect RBAC information and metrics into Log Analytics",
                "type": "PowerShell",
                "Id": ""
            }
        },
        "parentRunbookUri": "[concat(parameters('_artifactsLocation'),'/scripts/AzureRBACCollector-MS.ps1', parameters('_artifactsLocationSasToken'))]",
        "omsSolutions": {
            "customSolution": {
                "name": "Azure RBAC Monitor",
                "solutionName": "[concat('AzureRBACMonitoring', '[', parameters('logAnalyticsWorkspaceName'), ']')]",
                "publisher": "volkanc@microsoft.com",
                "displayName": "Azure RBAC Monitor",
                "description": "Monitor Azure RBAC Assignments accross management Groups and subscriptions",
                "author": "volkanc@microsoft.com"
            }
        },
        "ingestSchedulerGuid": "[guid(uniqueString(resourceGroup().id, deployment().name))]",
        "AZMONWorkspaceID": "AzureRBACMonitoring-AZMON_WS_ID",
        "AZMONWorkspaceIDType": "string",
        "AZMONWorkspaceIDDescription": "Value of the user's Azure Monitor",
        "AZMONWorkspaceKey": "AzureRBACMonitoring-AZMON_WS_KEY",
        "AZMONWorkspaceKeyType": "string",
        "AZMONWorkspaceKeyDescription": "Encrypted value of the user's omsWorkspaceKey",
        "createScheduleAutomationAccountName": "AzureRBACMonitoring-AzureAutomationAccount-MS-Mgmt",
        "createScheduleAutomationAccountType": "string",
        "createScheduleAutomationAccountDescription": "The name of the Automation Account",
        "createScheduleResourceGroupName": "AzureRBACMonitoring-AzureAutomationResourceGroup-MS-Mgmt",
        "createScheduleResourceGroupType": "string",
        "createScheduleResourceGroupDescription": "The name of the resource group",
        "automationSKU": "basic",
        "logAnalyticsSku":"pergb2018",
            "alertArray": [
            {
                "searchName": "Azure VMs in Stopped State",
                "description": "Azure VMs which shutdown from within operating system  will continue incurring charges. Stop the VM from the portal to prevent unnecessary consumption.",
                "severity": "Warning",
                "query": "Type=AzureRBACMonitoring_CL MetricName_s=VMInventory Status_s=Stopped | measure countdistinct(ID_s) by AzureSubscription_s,VmName_s",
                "alertTresholdValue": 0,
                "operator": "gt",
                "alertThrottleInMinutes": 60,
                "alertBreach": 1,
                "searchCategory": "Azure RBAC Monitor",
                "scheduleIntervalInMinutes": 15,
                "scheduleQueryTimeSpan": 15,
                "alertName": "Azure VM Found in Stopped State"
            },
            {
                "searchName": "Azure Quota Usage",
                "description": "Each Azure Subscription has quotas for VM cores per region. If the quota is reached new VMs annot be created",
                "severity": "Critical",
                "query": "Type=AzureRBACMonitoring_CL MetricName_s=ARMVMUsageStats   | EXTEND div(product(currentValue_d,100),limit_d) as UsedPct | Measure Max(UsedPct) by Location_s,Usagemetric_s | where AggregatedValue >90",
                "alertTresholdValue": 0,
                "operator": "gt",
                "alertThrottleInMinutes": 60,
                "alertBreach": 1,
                "searchCategory": "Azure RBAC Monitor",
                "scheduleIntervalInMinutes": 60,
                "scheduleQueryTimeSpan": 60,
                "alertName": "Azure Quota Usage Reached  90% of the Subscription Quota"
            }
        ]
    },
    "resources": [
                {
            "name": "[parameters('logAnalyticsWorkspaceName')]",
            "type": "Microsoft.OperationalInsights/workspaces",
            "apiVersion": "2015-11-01-preview",
            "location": "[parameters('logAnalyticsRegion')]",
            "properties": {
            },
            "resources":[
                     {
        "name": "ff96f876-7c32-40bf-b1bf-b60ad44ba0d8",
        "type": "microsoft.insights/workbooks",
        "apiVersion": "2018-06-17-preview",
            "location": "[parameters('logAnalyticsRegion')]",
        "tags": {
            "hidden-title": "Azure RBAC Report"
        }, "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName'))]"
            ],
          "kind": "shared",
    "properties": {
        "displayName": "Azure RBAC Report",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"386c5637-375e-437c-acdb-542be563ed5a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"testDataExist\\\",\\\"type\\\":1,\\\"query\\\":\\\"RBACReport_CL\\\\r\\\\n| take 1\\\",\\\"isHiddenWhenLocked\\\":true,\\\"timeContext\\\":{\\\"durationMs\\\":43200000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"testDataExist_Parameters\"},{\"type\":11,\"content\":\"{\\\"version\\\":\\\"LinkItem/1.0\\\",\\\"style\\\":\\\"tabs\\\",\\\"links\\\":[{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"Summary\\\",\\\"subTarget\\\":\\\"1\\\",\\\"postText\\\":\\\"\\\",\\\"style\\\":\\\"secondary\\\"},{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"ManagementGroupView\\\",\\\"subTarget\\\":\\\"2\\\",\\\"style\\\":\\\"link\\\"},{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"SubscriptionView\\\",\\\"subTarget\\\":\\\"3\\\",\\\"style\\\":\\\"link\\\",\\\"workbookContext\\\":{},\\\"alertRuleContext\\\":{}},{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"UserView\\\",\\\"subTarget\\\":\\\"4\\\",\\\"style\\\":\\\"link\\\"},{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"ResourceGroupViev\\\",\\\"subTarget\\\":\\\"5\\\",\\\"style\\\":\\\"link\\\"},{\\\"cellValue\\\":\\\"selectedTab\\\",\\\"linkTarget\\\":\\\"parameter\\\",\\\"linkLabel\\\":\\\"ResourceView\\\",\\\"subTarget\\\":\\\"6\\\",\\\"style\\\":\\\"link\\\",\\\"workbookContext\\\":{},\\\"alertRuleContext\\\":{}}]}\",\"conditionalVisibility\":{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Tabs\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"8a72f4ec-ce64-49b7-88dc-d9b27de74f7a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"MG\\\",\\\"label\\\":\\\"ManagementGroup\\\",\\\"type\\\":2,\\\"multiSelect\\\":true,\\\"quote\\\":\\\"\\\\\\\"\\\",\\\"delimiter\\\":\\\",\\\",\\\"query\\\":\\\"RBACReport_CL |where   ScopedTo_s == \\\\\\\"ManagementGroup\\\\\\\"\\\\r\\\\n|distinct  ManagementGroup_s | where isnotempty(ManagementGroup_s)| sort by ManagementGroup_s asc nulls last \\\",\\\"value\\\":[\\\"value::all\\\"],\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[\\\"value::all\\\"],\\\"selectAllValue\\\":\\\"*\\\"},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"doNotRunWhenHidden\\\":true,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"SubsParameters\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"8a72f4ec-ce64-49b7-88dc-d9b27de74f7a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Subs1\\\",\\\"label\\\":\\\"Subscription\\\",\\\"type\\\":2,\\\"multiSelect\\\":true,\\\"quote\\\":\\\"\\\\\\\"\\\",\\\"delimiter\\\":\\\",\\\",\\\"query\\\":\\\"RBACReport_CL | distinct  Subscription_s \\\",\\\"value\\\":[\\\"value::all\\\"],\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[\\\"value::all\\\"],\\\"selectAllValue\\\":\\\"*\\\"},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"doNotRunWhenHidden\\\":true,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"SubsParameters - Copy\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"8a72f4ec-ce64-49b7-88dc-d9b27de74f7a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Subs\\\",\\\"label\\\":\\\"Subscription\\\",\\\"type\\\":2,\\\"multiSelect\\\":true,\\\"quote\\\":\\\"\\\\\\\"\\\",\\\"delimiter\\\":\\\",\\\",\\\"query\\\":\\\"RBACReport_CL | distinct  Subscription_s \\\",\\\"value\\\":[\\\"Microsoft Azure Internal VCO\\\"],\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[\\\"value::all\\\"],\\\"selectAllValue\\\":\\\"*\\\"},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"},{\\\"id\\\":\\\"a47fa835-228d-4b0a-8833-2f8189b42641\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"ResourceGroup\\\",\\\"type\\\":2,\\\"query\\\":\\\"RBACReport_CL  \\\\r\\\\n| where ScopedTo_s ==\\\\\\\"ResourceGroup\\\\\\\"\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n|distinct  ResourceGroup \\\\r\\\\n|where isnotempty(ResourceGroup)| sort by ResourceGroup asc nulls last \\\",\\\"value\\\":\\\"Rg-Prod-Asia-vms\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"doNotRunWhenHidden\\\":true,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"RGViewParams\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"8a72f4ec-ce64-49b7-88dc-d9b27de74f7a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Resource\\\",\\\"label\\\":\\\"Search for Resource\\\",\\\"type\\\":1,\\\"value\\\":\\\"hana\\\"}],\\\"style\\\":\\\"pills\\\",\\\"doNotRunWhenHidden\\\":true,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"6\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"6\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"ResourceTabPArams\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"⚠ Metrics ingestion is still in progress; please note that it may take up to 30 minutes for data to appear.\\\\r\\\\n\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"testDataExist\",\"comparison\":\"isEqualTo\",\"value\":\"\"},\"name\":\"Error_NoData\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where ScopedTo_s  == \\\\\\\"ManagementGroup\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s \\\\r\\\\n| summarize Count=dcount(Scope_s) | project \\\\\\\"ManagementGroups\\\\\\\",Count\\\",\\\"size\\\":4,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Column1\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"rightContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"15\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Subs\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category , ObjectId_g , Subscription_s\\\\r\\\\n| summarize Count=dcount(Subscription_s) | project \\\\\\\"Subscriptions\\\\\\\",Count\\\",\\\"size\\\":4,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Column1\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"rightContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"15\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Subs - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment\\\\\\\"  and ScopedTo_s ==\\\\\\\"Subscription\\\\\\\"\\\\r\\\\n| where RoleDefinitionName_s == \\\\\\\"Owner\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , RoleDefinitionName_s\\\\r\\\\n| summarize Admins=dcount(SignInName_s) by RoleDefinitionName_s\\\",\\\"size\\\":4,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"RoleDefinitionName_s\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"rightContent\\\":{\\\"columnMatch\\\":\\\"Admins\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"15\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"LoadHistory_UtilizationSummary - Copy - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment Classic\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , RoleDefinitionName_s\\\\r\\\\n| summarize Count=dcount(SignInName_s) | project \\\\\\\"Classic Admins\\\\\\\",Count\\\",\\\"size\\\":4,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Column1\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"rightContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"15\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"ClassicAdmins\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let daystosearch=30d;\\\\r\\\\nlet subsfilter=RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(daystosearch)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where isnotempty(SubscriptionId)\\\\r\\\\n|project SubscriptionId;\\\\r\\\\nAzureActivity\\\\r\\\\n| where TimeGenerated > ago(daystosearch)\\\\r\\\\n|where SubscriptionId in (subsfilter)\\\\r\\\\n| where OperationNameValue   startswith \\\\\\\"Microsoft.Authorization/roleAssignments/\\\\\\\" \\\\r\\\\n| where ActivityStatusValue == \\\\\\\"Started\\\\\\\" \\\\r\\\\n| extend PrincipalId = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).PrincipalId) \\\\r\\\\n| extend RoleDefinitionId = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).RoleDefinitionId) \\\\r\\\\n| extend Scope = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).Scope) \\\\r\\\\n| project Caller , ActivityStatus , OperationName  , SubscriptionId , RoleAssignment=ResourceId, Resource , PrincipalId , RoleDefinitionId  , Scope ,\\\\tCorrelationId \\\\r\\\\n| join kind= inner (\\\\r\\\\n    AzureActivity\\\\r\\\\n| where TimeGenerated > ago(daystosearch)\\\\r\\\\n|where SubscriptionId in (subsfilter)\\\\r\\\\n| where OperationNameValue   startswith \\\\\\\"Microsoft.Authorization/roleAssignments/\\\\\\\" \\\\r\\\\n| where ActivityStatusValue == \\\\\\\"Succeeded\\\\\\\" \\\\r\\\\n| project CorrelationId , RoleAssignment=ResourceId , Resource =_ResourceId , TimeGenerated , CallerIpAddress\\\\r\\\\n) on CorrelationId , RoleAssignment\\\\r\\\\n| project Caller , TimeGenerated , OperationName , RoleAssignment , PrincipalId , Resource , Scope\\\\r\\\\n| summarize Count=count() by OperationName | project  OperationName , Count , \\\\\\\"RoleAssignmentLogs\\\\\\\"\\\",\\\"size\\\":4,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"OperationName\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"subtitleContent\\\":{\\\"columnMatch\\\":\\\"Column1\\\",\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"rightContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"ClassicAdmins - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| summarize dcount(ObjectId_g) by ObjectType_s \\\\r\\\\n| where ObjectType_s <> \\\\\\\"Unknown\\\\\\\" \\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Principal Types ( User / Group / SPN )\\\",\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"type\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"PrincipalTypes\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| where isnotempty(RoleAssignmentId_s)\\\\r\\\\n|summarize dcount(ObjectId_g) by ScopedTo_s\\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Role Assignments by Scope\\\",\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"type\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"PrincipalTypes - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment Classic\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category ,  Subscription_s , RoleDefinitionName_s\\\\r\\\\n| project Scope_s , ['User/Group/SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g) ,  Category ,  Subscription_s , RoleDefinitionName_s\\\\r\\\\n|union(\\\\r\\\\nRBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment\\\\\\\"  and ScopedTo_s  == \\\\\\\"Subscription\\\\\\\" \\\\r\\\\n| where RoleDefinitionName_s == \\\\\\\"Owner\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project Scope_s ,  ['User/Group/SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g),  Category ,  Subscription_s , RoleDefinitionName_s \\\\r\\\\n)\\\\r\\\\n|summarize count() by Role=RoleDefinitionName_s \\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Subscription Admins\\\",\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"type\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"AdminRolesSummary\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , Role=RoleDefinitionName_s , ObjectType_s\\\\r\\\\n| where ObjectType_s ==\\\\\\\"{type}\\\\\\\" \\\\r\\\\n| project ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for User\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"customWidth\":\"70\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"type\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for User\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| summarize dcount(ObjectId_g) by  RoleDefinitionName_s\\\\r\\\\n| sort by  dcount_ObjectId_g desc nulls last \\\",\\\"size\\\":0,\\\"title\\\":\\\"Role Definitions\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"categoricalbar\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"LoadHistory_UtilizationSummary - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , Role=RoleDefinitionName_s \\\\r\\\\n| where Role==\\\\\\\"{Role}\\\\\\\"\\\\r\\\\n| project ['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"User list for Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Role\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"User list for Role\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment Classic\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category ,  Subscription_s , RoleDefinitionName_s\\\\r\\\\n| project Scope_s , ['User/Group/SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g) ,  Category ,  Subscription_s , RoleDefinitionName_s\\\\r\\\\n|union(\\\\r\\\\nRBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment\\\\\\\"  and ScopedTo_s  == \\\\\\\"Subscription\\\\\\\" \\\\r\\\\n| where RoleDefinitionName_s == \\\\\\\"Owner\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project Scope_s ,  ['User/Group/SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g),  Category ,  Subscription_s , RoleDefinitionName_s \\\\r\\\\n)\\\\r\\\\n|sort by Subscription_s asc , ['User/Group/SPN'] asc\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Users with Admin Rights on Subscriptions\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"USersWithAdminsRightsonSubs\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let daystosearch=30d;\\\\r\\\\nAzureActivity\\\\r\\\\n| where TimeGenerated > ago(daystosearch)\\\\r\\\\n| where OperationNameValue   startswith \\\\\\\"Microsoft.Authorization/roleAssignments/\\\\\\\" \\\\r\\\\n| where ActivityStatusValue == \\\\\\\"Started\\\\\\\" \\\\r\\\\n| extend PrincipalId1= tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).PrincipalId)\\\\r\\\\n| extend PrincipalId2 = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).properties)).principalId)  \\\\r\\\\n| extend PrincipalId=iff(isnotempty(PrincipalId1),PrincipalId1,PrincipalId2) \\\\r\\\\n| extend RoleDefinitionId = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).RoleDefinitionId) \\\\r\\\\n| extend Scope = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).requestbody)).Properties)).Scope) \\\\r\\\\n| project Caller , ActivityStatus , OperationName  , SubscriptionId , RoleAssignmentId=ResourceId, Resource , PrincipalId , RoleDefinitionId  , Scope ,\\\\tCorrelationId \\\\r\\\\n| join kind= inner (\\\\r\\\\n    AzureActivity\\\\r\\\\n| where TimeGenerated > ago(daystosearch)\\\\r\\\\n| where OperationNameValue   startswith \\\\\\\"Microsoft.Authorization/roleAssignments/\\\\\\\" \\\\r\\\\n| where ActivityStatusValue == \\\\\\\"Succeeded\\\\\\\" \\\\r\\\\n| project CorrelationId , RoleAssignmentId=ResourceId , Resource =_ResourceId , TimeGenerated , CallerIpAddress\\\\r\\\\n) on CorrelationId , RoleAssignmentId\\\\r\\\\n| project Caller , TimeGenerated , OperationName , RoleAssignmentId , PrincipalId , Resource , Scope ,SubscriptionId\\\\r\\\\n| join kind= leftouter (\\\\r\\\\n    RBACReport_CL \\\\r\\\\n| distinct SignInDisplayName_s , ObjectId_g , SubscriptionId\\\\r\\\\n| project SignInDisplayName_s , PrincipalId=ObjectId_g , SubscriptionId\\\\r\\\\n) on SubscriptionId , PrincipalId\\\\r\\\\n| project Assignee=Caller , TimeGenerated , OperationName ,  AssigedTo=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,PrincipalId) ,  Scope ,RoleAssignmentId ,SubscriptionId\\\\r\\\\n|join kind= leftouter (\\\\r\\\\nRBACReport_CL \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n|project AssigedTo=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g),RoleAssignmentId=RoleAssignmentId_s ,ResourceScope=Scope_s\\\\r\\\\n) on RoleAssignmentId\\\\r\\\\n| project Assignee , TimeGenerated , OperationName ,  AssigedTo , Scope=iff(isnotempty(Scope),Scope,ResourceScope),RoleAssignmentId ,SubscriptionId\\\\r\\\\n\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Activity Logs - RBAC Assigment Operations in Last 30 days\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"RBACActivityLog - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n|where   ScopedTo_s == \\\\\\\"ManagementGroup\\\\\\\"\\\\r\\\\n| where ManagementGroup_s   in ({MG})  or '*'  in ({MG})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| summarize dcount(ObjectId_g) by  RoleDefinitionName_s\\\",\\\"size\\\":0,\\\"title\\\":\\\"Role Definitions\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"categoricalbar\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"MG_RolesAssigned\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n|where   ScopedTo_s == \\\\\\\"ManagementGroup\\\\\\\"\\\\r\\\\n| where ManagementGroup_s   in ({MG})  or '*'  in ({MG})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project ManagementGroup=iff(isnotempty(ManagementGroup_s),ManagementGroup_s,ManagementGroup_g),ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(SignInName_s),SignInName_s,SignInDisplayName_s),Role=RoleDefinitionName_s ,  Scope=Scope_s\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for User\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"ManagementGroup\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"ObjectType\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"User or SPN\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Role\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Scope\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Column1\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"$gen_group\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Management Group\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"hierarchySettings\\\":{\\\"treeType\\\":1,\\\"groupBy\\\":[\\\"ManagementGroup\\\"]}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for MG\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where ManagementGroup_s   in ({MG})  or '*'  in ({MG})\\\\r\\\\n| where Category == \\\\\\\"RBAC Assignment\\\\\\\"  and    ScopedTo_s == \\\\\\\"ManagementGroup\\\\\\\"\\\\r\\\\n| where RoleDefinitionName_s == \\\\\\\"Owner\\\\\\\" \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| where isnotempty(ManagementGroup_s)\\\\r\\\\n| project ManagementGroup=ManagementGroup_s ,  ['User/Group/SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,ObjectId_g),  Category , Role=RoleDefinitionName_s ,  Subscription_s \\\\r\\\\n|sort by ManagementGroup  asc \\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Users with Admin Rights on Management Groups\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"sortBy\\\":[{\\\"itemKey\\\":\\\"User/Group/SPN\\\",\\\"sortOrder\\\":1}]},\\\"sortBy\\\":[{\\\"itemKey\\\":\\\"User/Group/SPN\\\",\\\"sortOrder\\\":1}]}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"USersWithAdminsRightsonMG\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs1})  or '*'  in ({Subs1})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , SignInDisplayName_s, ManagementGroupName  , RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , RoleDefinitionName_s\\\\r\\\\n| summarize dcount(ObjectId_g) by  RoleDefinitionName_s\\\",\\\"size\\\":0,\\\"title\\\":\\\"Role Definitions\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"categoricalbar\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Subs_RolesAssigned \"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs1})  or '*'  in ({Subs1})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , ManagementGroup_s,Subscription_s, User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g ,  Role=RoleDefinitionName_s , ObjectType_s\\\\r\\\\n| project Subscription=Subscription_s,ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for User\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for subs\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)//| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope_s , SignInName_s , RoleDefinitionId_g , Category , ObjectId_g , Subscription_s\\\\r\\\\n| summarize dcount(ObjectId_g) by ObjectType_s \\\\r\\\\n| where ObjectType_s <> \\\\\\\"Unknown\\\\\\\" \\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Principal Types ( User / Group / SPN )\\\",\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"type\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"PrincipalTypes - Copy\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"⚠ Select an object type from the chart to see the details\\\"}\",\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"type\",\"comparison\":\"isEqualTo\"},\"conditionalVisibilities\":[{\"parameterName\":\"type\",\"comparison\":\"isEqualTo\"},{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"}],\"name\":\"text - 17\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)//| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , Role=RoleDefinitionName_s , ObjectType_s\\\\r\\\\n| where ObjectType_s ==\\\\\\\"{type}\\\\\\\" \\\\r\\\\n| project ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for User\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"type\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for User \"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"9009a14b-c42e-481e-b327-bd3b767bbd35\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Searchuser\\\",\\\"label\\\":\\\"Search for User\\\",\\\"type\\\":1,\\\"value\\\":\\\"user\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},\"name\":\"parameters - 25\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)//\\\\r\\\\n| where SignInName_s contains  '{Searchuser}'  or SignInDisplayName_s contains  '{Searchuser}' \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , Role=RoleDefinitionName_s , ObjectType_s , ScopedTo_s\\\\r\\\\n| project ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope ,ScopedTo=ScopedTo_s\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for Searched User\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"4\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Searchuser\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for Searched User\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where ScopedTo_s ==\\\\\\\"ResourceGroup\\\\\\\"\\\\r\\\\n| where ResourceGroup==\\\\\\\"{ResourceGroup}\\\\\\\"\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| summarize dcount(ObjectId_g) by  RoleDefinitionName_s\\\\r\\\\n| sort by  dcount_ObjectId_g desc nulls last \\\",\\\"size\\\":0,\\\"title\\\":\\\"Roles Assigned for  RG\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"categoricalbar\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"RolesperRG\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let subs=RBACReport_CL \\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where ScopedTo_s ==\\\\\\\"ResourceGroup\\\\\\\"\\\\r\\\\n| where ResourceGroup==\\\\\\\"{ResourceGroup}\\\\\\\"\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project SubscriptionId | take 1;\\\\r\\\\nRBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where ResourceGroup==\\\\\\\"{ResourceGroup}\\\\\\\"\\\\r\\\\n| where ScopedTo_s ==\\\\\\\"ResourceGroup\\\\\\\"\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project AssignmentType=\\\\\\\"This Resource\\\\\\\",ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,SignInDisplayName_s), Role=RoleDefinitionName_s , Scope=Scope_s  ,ScopedTo=ScopedTo_s , SubscriptionId\\\\r\\\\n|union(\\\\r\\\\nRBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where ScopedTo_s ==\\\\\\\"Subscription\\\\\\\"\\\\r\\\\n| where SubscriptionId ==toscalar(subs)\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project AssignmentType=\\\\\\\"Inherited from Subs\\\\\\\", ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,SignInDisplayName_s), Role=RoleDefinitionName_s , Scope=Scope_s  ,ScopedTo=ScopedTo_s , SubscriptionId\\\\r\\\\n),(\\\\r\\\\nRBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)\\\\r\\\\n| where Subscription_s in ({Subs})  or '*'  in ({Subs})\\\\r\\\\n| where ScopedTo_s ==\\\\\\\"ManagementGroup\\\\\\\"\\\\r\\\\n| where SubscriptionId == toscalar(subs)\\\\r\\\\n| summarize arg_max(TimeGenerated, *) by  RoleAssignmentId_s, ObjectId_g,  RoleDefinitionId_g ,Scope_s \\\\r\\\\n| project AssignmentType=\\\\\\\"Inherited from MG\\\\\\\", ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(SignInDisplayName_s),SignInDisplayName_s,SignInDisplayName_s), Role=RoleDefinitionName_s , Scope=Scope_s  ,ScopedTo=ScopedTo_s , SubscriptionId\\\\r\\\\n)\\\",\\\"size\\\":0,\\\"title\\\":\\\"All Roles Asiigned and Inherited \\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"exportFieldName\\\":\\\"series\\\",\\\"exportParameterName\\\":\\\"Role\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Site\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IISLatency(ms)\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<=\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\">\\\",\\\"thresholdValue\\\":\\\"10\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}},{\\\"columnMatch\\\":\\\"Wait Time Others(ms)\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Host\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration used (%)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Memory used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Disk used (GB)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network in (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Network out (MB/s)\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SPDuration\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"max\\\":100,\\\"palette\\\":\\\"redDark\\\",\\\"showIcon\\\":true}}]},\\\"sortBy\\\":[],\\\"chartSettings\\\":{\\\"seriesLabelSettings\\\":[{\\\"seriesName\\\":\\\"ServicePrincipal\\\",\\\"color\\\":\\\"orange\\\"},{\\\"seriesName\\\":\\\"User\\\",\\\"color\\\":\\\"green\\\"}],\\\"ySettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}}}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"5\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"RolesperRG - Copy\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"RBACReport_CL \\\\r\\\\n| where TimeGenerated >= ago(1d)//\\\\r\\\\n| where Scope_s  contains  '{Resource}' \\\\r\\\\n| summarize arg_max(TimeGenerated, *) by Scope=Scope_s , User=SignInName_s ,SignInDisplayName_s, RoleDefinitionId_g , Category , ObjectId_g , Subscription_s , Role=RoleDefinitionName_s , ObjectType_s , ScopedTo_s\\\\r\\\\n| project ObjectType=ObjectType_s,['User or SPN']=iff(isnotempty(User),User,SignInDisplayName_s), Role , Scope ,ScopedTo=ScopedTo_s\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"title\\\":\\\"Assignments for Resource\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\"}\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"6\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"6\"},{\"parameterName\":\"testDataExist\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Searchuser\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Assignments for Searched resource\"}],\"isLocked\":false,\"fromTemplateId\":\"community-Workbooks/SapMonitor/SapHanaInfrastructure\"}",
        "version": "Notebook/1.0",
        "category": "workbook",
        "sourceId": "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName'))]",
          "tags": []
        }
    }



            ]            
        },
        {
            "apiversion": "2015-10-31",
            "location": "[parameters('automationRegion')]",
            "name": "[parameters('automationAccountName')]",
            "type": "Microsoft.Automation/automationAccounts",
            "properties": {
                "sku": {
                    "name": "[variables('automationSKU')]"
                }
            },
            "resources": [
                {
                    "name": "[variables('AZMONWorkspaceID')]",
                    "type": "variables",
                    "apiVersion": "2015-10-31",
                    "dependsOn": [
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]"
                    ],
                    "tags": {},
                    "properties": {
                        "description": "[variables('AZMONWorkspaceIDDescription')]",
                        "isEncrypted": 0,
                        "type": "[variables('AZMONWorkspaceIDType')]",
                        "value": "[concat('\"',reference(resourceId('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName')), '2015-11-01-preview').customerId,'\"')]"
                    }
                },
                {
                    "name": "[variables('AZMONWorkspaceKey')]",
                    "type": "variables",
                    "apiVersion": "2015-10-31",
                    "dependsOn": [
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]"
                    ],
                    "tags": {},
                    "properties": {
                        "description": "[variables('AZMONWorkspaceKeyDescription')]",
                        "isEncrypted": 1,
                        "type": "[variables('AZMONWorkspaceKeyType')]",
                        "value": "[concat('\"',listKeys(resourceId('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName')), '2015-11-01-preview').primarySharedKey,'\"')]"
                    }
                },
                {
                    "name": "[variables('createScheduleAutomationAccountName')]",
                    "type": "variables",
                    "apiVersion": "2015-10-31",
                    "dependsOn": [
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]"
                    ],
                    "tags": {},
                    "properties": {
                        "description": "[variables('createScheduleAutomationAccountDescription')]",
                        "isEncrypted": 0,
                        "type": "[variables('createScheduleAutomationAccountType')]",
                        "value": "[concat('\"', parameters('automationAccountName'),'\"')]"
                    }
                },
                {
                    "name": "[variables('createScheduleResourceGroupName')]",
                    "type": "variables",
                    "apiVersion": "2015-10-31",
                    "dependsOn": [
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]"
                    ],
                    "tags": {},
                    "properties": {
                        "description": "[variables('createScheduleResourceGroupDescription')]",
                        "isEncrypted": 0,
                        "type": "[variables('createScheduleResourceGroupType')]",
                        "value": "[concat('\"', resourceGroup().name, '\"')]"
                    }
                },
                {
                    "name": "[variables('runbooks').ingestParentRunbook.name]",
                    "type": "runbooks",
                    "apiVersion": "2015-10-31",
                    "location": "[parameters('automationRegion')]",
                    "dependsOn": [
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]",
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'), '/variables/', variables('AZMONWorkspaceID'))]",
                        "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'), '/variables/', variables('AZMONWorkspaceKey'))]"
                    ],
                    "tags": {},
                    "properties": {
                        "runbookType": "[variables('runbooks').ingestParentRunbook.type]",
                        "logProgress": "false",
                        "logVerbose": "false",
                        "description": "[variables('runbooks').ingestParentRunbook.description]",
                        "publishContentLink": {
                            "uri": "[variables('parentRunbookUri')]",
                            "version": "[variables('runbooks').ingestParentRunbook.version]"
                        }
                    }
                }
            ]
        },
        {
            "name": "[variables('omsSolutions').customSolution.solutionName]",
            "type": "Microsoft.OperationsManagement/solutions",
            "apiVersion": "2015-11-01-preview",
            "location": "[parameters('logAnalyticsRegion')]",
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName'))]",
                "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'))]",
                "[concat('Microsoft.Automation/automationAccounts/', parameters('automationAccountName'), '/runbooks/', variables('runbooks').ingestParentRunbook.name)]"
            ],
            "plan": {
                "name": "[variables('omsSolutions').customSolution.solutionName]",
                "product": "[variables('omsSolutions').customSolution.name]",
                "publisher": "[variables('omsSolutions').customSolution.publisher]",
                "promotionCode": ""
            },
            "properties": {
                "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName'))]",
                "referencedResources": [],
                "containedResources": [
                    "[resourceId('Microsoft.OperationalInsights/workspaces/views/', parameters('logAnalyticsWorkspaceName'), variables('omsSolutions').customSolution.name)]",
                    "[resourceId('Microsoft.Automation/automationAccounts/runbooks/', parameters('automationAccountName'), variables('runbooks').ingestParentRunbook.name)]",
                    "[resourceId('Microsoft.Automation/automationAccounts/variables/', parameters('automationAccountName'), variables('AZMONWorkspaceID'))]",
                    "[resourceId('Microsoft.Automation/automationAccounts/variables/', parameters('automationAccountName'), variables('AZMONWorkspaceKey'))]",
                    "[resourceId('Microsoft.Automation/automationAccounts/variables/', parameters('automationAccountName'), variables('createScheduleAutomationAccountName'))]",
                    "[resourceId('Microsoft.Automation/automationAccounts/variables/', parameters('automationAccountName'), variables('createScheduleResourceGroupName'))]"
                ]
            }
        },
        {
            "apiVersion": "2015-11-01-preview",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "name": "[concat(parameters('logAnalyticsWorkspaceName'), '/', tolower(variables('alertArray')[copyIndex()].searchCategory), '|', toLower(variables('alertArray')[copyIndex()].searchName))]",
            "copy": {
                "name": "savedsearchcopy",
                "count": "[length(variables('alertArray'))]"
            },
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('logAnalyticsWorkspaceName'))]"
             ],
            "properties": {
                "etag": "*",
                "query": "[variables('alertArray')[copyIndex()].query]",
                "displayName": "[variables('alertArray')[copyIndex()].searchName]",
                "category": "[variables('alertArray')[copyIndex()].searchCategory]"
            }
        }
       
    ],
    "outputs": {}
}